---
services:
  opencode:
    container_name: opencode
    image: dceoy/opencode:latest
    build:
      context: .
      dockerfile: Dockerfile
      target: cli
      platforms:
        - linux/arm64
        - linux/amd64
      args:
        UBUNTU_VERSION: '24.04'
        PYTHON_VERSION: '3.13'
        USER_NAME: cli
        USER_UID: 1001
        USER_GID: 1001
      cache_from:
        - type=gha
      cache_to:
        - type=gha,mode=max
    volumes:
      - ${PWD}:/workspace
      - ${HOME}/.gitconfig:/home/cli/.gitconfig
      - opencode_data:/home/cli/.opencode
    working_dir: /workspace
    entrypoint:
      - /usr/local/bin/opencode
volumes:
  opencode_data:
    name: opencode_data
    driver: local
